{% extends 'base.html' %}

{% block head %}
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flat-ui/2.2.2/css/flat-ui.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <style>
			body {
			  font-family: 'Open Sans', sans-serif;
			  font-weight: 300;
			  line-height: 1.42em;
			  color:#A7A1AE;
			  background-color:#1F2739;
			}
			
			h1 {
			  font-size:3em;
			  font-weight: 300;
			  line-height:1em;
			  text-align: center;
			  color: #4DC3FA;
			}

			h2 {
			  font-size:3em;
			  font-weight: 300;
			  font-weight: bold;
			  line-height:1em;
			  text-align: center;
			  color: white;
			}
			
			.per {
				font-size: 15px;
			}
			
			.container2 th h1 {
				  font-weight: bold;
				  font-size: 1.3em;
			  color: #185875;
			}

			.container2 td {
				  font-weight: normal;
				  font-size: 1em;
				    -webkit-box-shadow: 0 2px 2px -2px #0E1119;
				   -moz-box-shadow: 0 2px 2px -2px #0E1119;
						box-shadow: 0 2px 2px -2px #0E1119;
			}

			.container2 {
				  text-align: center;
				  overflow: hidden;
				  text-overflow: clip;
				  width: 90%;
				  margin: 0 auto;
			  display: table;
			  padding: 0 0 8em 0;
			}

			.container2 .shift {
				width: 10%;
			}

			.container2 td, .container2 th {
				  padding-bottom: 2%;
				  padding-top: 2%;
			  padding-left:2%;
			}

			/* Background-color of the odd rows */
			.container2 tr:nth-child(odd) {
				  background-color: #323C50;
			}

			/* Background-color of the even rows */
			.container2 tr:nth-child(even) {
				  background-color: #2C3446;
			}

			.container2 th {
				  background-color: #1F2739;
			}

			.container2 tr:hover {
			   background-color: #464A52;
				  -webkit-box-shadow: 0 6px 6px -6px #0E1119;
				   -moz-box-shadow: 0 6px 6px -6px #0E1119;
						box-shadow: 0 6px 6px -6px #0E1119;
			}

			.container2 td:hover {
			  background-color: #FFF842;
			  color: #403E10;
			  box-shadow: #7F7C21 -1px 1px, #7F7C21 -2px 2px, #7F7C21 -3px 3px, #7F7C21 -4px 4px, #7F7C21 -5px 5px, #7F7C21 -6px 6px;
			  transform: translate3d(6px, -6px, 0);

			  transition-delay: 0s;
				  transition-duration: 0.4s;
				  transition-property: all;
			  transition-timing-function: line;
			}
			
			.navbar-inverse {
				-webkit-transition: all 0.2s ease-in;
				transition: all 0.2s ease-in;
			}
			
			.transparent {
			  background: transparent;
			}
			
			#menuToggle {
			  display: block;
			  position: fixed;
			  top: 20px;
			  left: 20px;
			  
			  z-index: 1;
			  
			  -webkit-user-select: none;
			  user-select: none;
			}

			#menuToggle a{
			  text-decoration: none;
			  color: #232323;
			  
			  transition: color 0.3s ease;
			}

			#menuToggle a:hover{
			  color: tomato;
			}


			#menuToggle input{
			  display: block;
			  width: 40px;
			  height: 32px;
			  position: absolute;
			  top: -7px;
			  left: -5px;
			  
			  cursor: pointer;
			  
			  opacity: 0; /* hide this */
			  z-index: 2; /* and place it over the hamburger */
			  
			  -webkit-touch-callout: none;
			}

			#menuToggle span{
			  display: block;
			  width: 33px;
			  height: 4px;
			  margin-bottom: 5px;
			  position: relative;
			  
			  background: #cdcdcd;
			  border-radius: 3px;
			  
			  z-index: 1;
			  
			  transform-origin: 4px 0px;
			  
			  transition: transform 0.5s cubic-bezier(0.77,0.2,0.05,1.0),
						  background 0.5s cubic-bezier(0.77,0.2,0.05,1.0),
						  opacity 0.55s ease;
			}

			#menuToggle span:first-child{
			  transform-origin: 0% 0%;
			}

			#menuToggle span:nth-last-child(2){
			  transform-origin: 0% 100%;
			}

			#menuToggle input:checked ~ span{
			  opacity: 1;
			  transform: rotate(45deg) translate(-2px, -1px);
			  background: #232323;
			}

			#menuToggle input:checked ~ span:nth-last-child(3){
			  opacity: 0;
			  transform: rotate(0deg) scale(0.2, 0.2);
			}
			
			#menuToggle input:checked ~ span:nth-last-child(2){
			  transform: rotate(-45deg) translate(0, -1px);
			}
			#menu{
			  position: absolute;
			  width: 300px;
			  margin: -100px 0 0 -50px;
			  padding: 50px;
			  padding-top: 125px;
			  
			  background: #ededed;
			  list-style-type: none;
			  -webkit-font-smoothing: antialiased;
			  /* to stop flickering of text in safari */
			  
			  transform-origin: 0% 0%;
			  transform: translate(-100%, 0);
			  
			  transition: transform 0.5s cubic-bezier(0.77,0.2,0.05,1.0);
			}

			#menu li{
			  padding: 10px 0;
			  font-size: 22px;
			}

			#menuToggle input:checked ~ ul{
			  transform: none;
			}
			
			body.swal2-shown > [aria-hidden="true"] {
			  filter: blur(10px);
			}

			body > * {
			  transition: 0.1s filter linear;
			}
			
			 .fa-print, .fa-cogs, .fa-plus-circle{
				font-size:36px;
				float:right;
				padding-right:20px;
				cursor: pointer;
			 }
			
			@media (max-width: 800px) {
				.container2 td {font-size: 0.5em;}
				.container2 th h1{font-size: 0.5em;}
				.per {font-size: 0.8em;}
				 h1 { font-size: 2em; }
				.fa-print, .fa-cogs, .fa-plus-circle { font-size: 24px;}
			}
			
			@media (max-width: 800px) {
				.container2 td {font-size: 0.5em;}
				.container2 th h1{font-size: 0.6em;}
				.per {font-size: 13px;}
				h1 { font-size: 2em; }
			}
  </style>
  
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script>
	function check_shift(shift, date, id){
		$.ajax(
			{ url: '/schedule/create_shift/' + shift + '/' + date + "/check",
			 success: function(data){
				if (data['db'] == "None"){
					document.getElementById(id).style.color = "grey";
					document.getElementById(id).innerHTML = "";
				}else{
					document.getElementById(id).style.color = "red";
					document.getElementById(id).innerHTML = "blocked by " + "{{ g.user['username'] }}";
				}
			}
		});
	}
	
    function create(shift, date, id){
		var status = document.getElementById(id).textContent;
		$.post('{{ url_for("schedule.create_shift") }}', {
				shift: shift,
				date: date,
				action: "handle"}, function(data){
				if (data['db'] == "backdate"){
					alert("this shaift is backdate and will not be inserted into the schedule. pick a nother shift from next week");
				}
				else{
					if (status == "blocked by " + "{{ g.user['username'] }}"){
						document.getElementById(id).style.color = "grey";
						document.getElementById(id).innerHTML = "";
					}else{
						document.getElementById(id).style.color = "red";
						document.getElementById(id).innerHTML = "blocked by " + "{{ g.user['username'] }}";
					}
				}
			}, "json");
    }
	
	function alert_fire(){
		(async () => {

		const { value: fruit } = await Swal.fire({
		  title: 'Select field validation',
		  input: 'select',
		  inputOptions: {
			'Fruits': {
			  apples: 'Apples',
			  bananas: 'Bananas',
			  grapes: 'Grapes',
			  oranges: 'Oranges'
			},
			'Vegetables': {
			  potato: 'Potato',
			  broccoli: 'Broccoli',
			  carrot: 'Carrot'
			},
			'icecream': 'Ice cream'
		  },
		  inputPlaceholder: 'Select a fruit',
		  showCancelButton: true,
		  inputValidator: (value) => {
			return new Promise((resolve) => {
			  if (value === 'oranges') {
				resolve()
			  } else {
				resolve('You need to select oranges :)')
			  }
			})
		  }
		})

		if (fruit) {
		  Swal.fire(`You selected: ${fruit}`)
		}

		})()
	}
	
  </script>
{% endblock %}
{% block header %}
  <h1 style="text-align: center;" onclick="alert_fire()"><i class="icon fa fa-list-alt"></i>   {% block title %}Schedule{% endblock %}</h1>
  <nav role="navigation">
	  <div id="menuToggle">
		<input type="checkbox" />
		<span></span>
		<span></span>
		<span></span>
		<ul id="menu">
		  <a href="{{ url_for('home.index') }}"><li><i class="fa fa-home" aria-hidden="true" style="font-size:24px;"></i>  Home</li></a>
		  <a href="{{ url_for('home.about') }}"><li><i class="fa fa-info" aria-hidden="true" style="font-size:24px;"></i>  About</li></a>
		  <a href="{{ url_for('home.contact') }}"><li><i class="fa fa-id-card" style="font-size:24px;"></i>  Contact</li></a>
		  <a href="{{ url_for('auth.logout') }}"><li><i class="fa fa-sign-out" aria-hidden="true" style="font-size:24px;"></i>  Logout</li></a>
		</ul>
	  </div>
	</nav>
{% endblock %}

{% block content %}
	{% for index in range_matrix %}
	  <table class="container2">
		<tr>
		  <th><h1>______</h1></th>
		  {% for k in range2 %}
				<th><h1>{{ days[index][k] }}</h1></th>
		  {% endfor %}
		</tr>
		{% for i in range %}
		<tr>
		  <td class="shift" style="text-align: center;">{{ table[i].replace(":00", "") }}</td>
		  {% for j in range2 %}
			<td class="square{{ index }}{{ i }}{{ j }}" style="text-align: center;"
			  onclick="create('{{ table[i] }}', '{{ days[index][j].replace('\r\n', ' ') }}', 'p{{ index }}{{ i }}{{ j }}')">
			  {% for row in schedule %}
				  {% if (table[i] == row['shift']) and (days[index][j].replace("\r\n", " ") == row['date']) and g.user['id'] == row['author_id'] %}  
					<p id="p{{ index }}{{ i }}{{ j }}" class="per" style="color: red;">blocked by {{ row['username'] }}</p>
				  {% endif %}
			  {% endfor %}
			  <p id="p{{ index }}{{ i }}{{ j }}" class="per"></p>
			  </td>
		  {% endfor %}
		</tr>
		{% endfor %}
	  </table>
	{% endfor %}
{% endblock %}
<br>
<br>
<br>
<br>